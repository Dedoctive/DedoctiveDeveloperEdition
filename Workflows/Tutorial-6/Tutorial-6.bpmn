<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:spiffworkflow="http://spiffworkflow.org/bpmn/schema/1.0/core" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:bioc="http://bpmn.io/schema/bpmn/biocolor/1.0" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color/1.0" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:open-bpmn="http://open-bpmn.org/XMLSchema" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn">
  <bpmn:extensionElements>
    <open-bpmn:auto-align>true</open-bpmn:auto-align>
  </bpmn:extensionElements>
  <bpmn:collaboration id="Tutorial-6">
    <bpmn:documentation> BPMN Workflows Agents can be invoked as a workflow Task
In the previous tutorials we have seen how either an agentic service task (LLMAgent) or a tool service task (MCPTool) can invoke a mcpTool. The latter does this deterministically whilst the former will execute the tool determined by the request. 

There will be many use-cases in which there is no mcpTool that performs the task required to satisfy the business requirements of the workflow. However, this 'task' could be created as a BPMN workflow as described in the prior tutorials. 

BPMN already allows one workflow to invoke another workflow, as shown in the last tutorial.

Therefore in this tutorial we show how an existing DedoctiveDeduction workflow can be used as a tool within an agentic LLMAgent</bpmn:documentation>
    <bpmn:participant id="Main" name="Main" processRef="__main__" />
  </bpmn:collaboration>
  <bpmn:process id="__main__" name="__main__">
    <bpmn:startEvent id="StartMain" name="StartMain">
      <bpmn:outgoing>Flow_15k6erz</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="Flow_15k6erz" sourceRef="StartMain" targetRef="UserForm" />
    <bpmn:sequenceFlow id="Flow_0e67u93" sourceRef="UserForm" targetRef="CallExternalWorkflow" />
    <bpmn:userTask id="UserForm" name="UserForm">
      <bpmn:extensionElements>
        <spiffworkflow:properties>
          <spiffworkflow:property name="formJsonSchema" value="{&#10;  &#34;schema&#34;: {&#10;    &#34;type&#34;: &#34;object&#34;,&#10;    &#34;properties&#34;: {&#10;      &#34;query&#34;: {&#10;        &#34;title&#34;: &#34;Query&#34;,&#10;        &#34;type&#34;: &#34;string&#34;,&#10;        &#34;description&#34;: &#34;Enter a query that you want the LLM to answer using its tools&#34;&#10;      }&#10;    },&#10;    &#34;dependencies&#34;: {},&#10;    &#34;required&#34;: []&#10;  },&#10;  &#34;uiSchema&#34;: {&#10;    &#34;ui:order&#34;: [&#10;      &#34;query&#34;&#10;    ]&#10;  }&#10;}" />
        </spiffworkflow:properties>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_15k6erz</bpmn:incoming>
      <bpmn:outgoing>Flow_0e67u93</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:endEvent id="EndMain" name="EndMain">
      <bpmn:incoming>Flow_1ky9wia</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_1ky9wia" sourceRef="CallExternalWorkflow" targetRef="EndMain" />
    <bpmn:serviceTask id="CallExternalWorkflow" name="CallExternalWorkflow">
      <bpmn:extensionElements>
        <spiffworkflow:serviceTaskOperator id="adk/WorkflowAgent" resultVariable="workflowResponse">
          <spiffworkflow:parameters />
        </spiffworkflow:serviceTaskOperator>
        <spiffworkflow:properties>
          <spiffworkflow:property name="workflowAgentParams" value="{&#10;  &#34;workflowValue&#34;: &#34;Tutorial-2&#34;,&#10;  &#34;workflowInput&#34;: {&#10;    &#34;superFormData&#34;: &#34;{{formData.query}}&#34;&#10;  }&#10;}" />
        </spiffworkflow:properties>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0e67u93</bpmn:incoming>
      <bpmn:outgoing>Flow_1ky9wia</bpmn:outgoing>
    </bpmn:serviceTask>
  </bpmn:process>
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Tutorial-6">
      <bpmndi:BPMNShape id="Participant_1pkignq_di" bpmnElement="Main" isHorizontal="true">
        <dc:Bounds x="190" y="30" width="680" height="200" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0cadgaf_di" bpmnElement="StartMain">
        <dc:Bounds x="252" y="122" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="246" y="165" width="49" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_17b4uey_di" bpmnElement="UserForm">
        <dc:Bounds x="350" y="100" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0nmrmhi_di" bpmnElement="EndMain" bioc:stroke="#000000" bioc:fill="#009238" color:background-color="#009238" color:border-color="#000000">
        <dc:Bounds x="782" y="122" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="779" y="165" width="45" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_1er23x5_di" bpmnElement="CallExternalWorkflow">
        <dc:Bounds x="550" y="100" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_15k6erz_di" bpmnElement="Flow_15k6erz">
        <di:waypoint x="288" y="140" />
        <di:waypoint x="350" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0e67u93_di" bpmnElement="Flow_0e67u93">
        <di:waypoint x="450" y="140" />
        <di:waypoint x="550" y="140" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1ky9wia_di" bpmnElement="Flow_1ky9wia">
        <di:waypoint x="650" y="140" />
        <di:waypoint x="782" y="140" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
